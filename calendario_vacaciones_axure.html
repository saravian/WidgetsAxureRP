<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Calendario de Vacaciones</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f4f6f8;
    padding: 16px;
    font-size: 13px;
    color: #333;
  }

  .calendar-wrapper {
    background: #fff;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    padding: 16px;
    display: inline-flex;
    flex-direction: column;
    gap: 12px;
    min-width: 100%;
  }

  /* â”€â”€ Navigation â”€â”€ */
  .nav-bar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding-bottom: 10px;
    border-bottom: 1px solid #dee2e6;
  }
  .nav-bar button {
    background: #fff;
    border: 1px solid #dee2e6;
    border-radius: 4px;
    width: 30px; height: 30px;
    cursor: pointer;
    font-size: 17px;
    color: #555;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.1s;
  }
  .nav-bar button:hover    { background: #f0f0f0; }
  .nav-bar button:disabled { opacity: 0.3; cursor: default; }
  .nav-label { font-size: 13px; color: #666; font-weight: 500; }

  /* â”€â”€ Months â”€â”€ */
  .months-container { display: flex; gap: 16px; align-items: flex-start; }
  .month-divider    { width: 1px; background: #dee2e6; align-self: stretch; flex-shrink: 0; }
  .month-block      { flex: 1; min-width: 0; }
  .month-title      {
    text-align: center; font-weight: 700; font-size: 13px;
    color: #333; margin-bottom: 8px; text-transform: capitalize;
  }

  .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; }
  .day-name {
    text-align: center; font-size: 10px; font-weight: 700;
    color: #999; padding: 2px 0 5px;
  }

  /* â”€â”€ Day cell â”€â”€ */
  .day-cell {
    position: relative;
    border-radius: 4px;
    overflow: hidden;
    aspect-ratio: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    font-weight: 500;
    border: 1px solid transparent;
    user-select: none;
  }
  .day-cell.empty  { visibility: hidden; }
  .day-cell.today  { border-color: #0d6efd !important; }
  .day-num         { position: relative; z-index: 2; line-height: 1; pointer-events: none; }

  /* Full day */
  .full-vac       { background: #c8f0c8; color: #1a5c1a; border-color: #72c472; }

  .full-nolaboral { background: #fff3a0; color: #6b5900; border-color: #e6c800; }
  .full-reintegro { background: #b8d8ff; color: #003a7a; border-color: #5aaaf5; }
  .normal         { background: #fff;    color: #333;    border-color: #eee;    }

  /* Half day */
  .day-cell.half  { background: transparent !important; border-color: #ccc; }
  .half-left, .half-right { position: absolute; top: 0; bottom: 0; width: 50%; }
  .half-left  { left: 0; }
  .half-right { right: 0; }
  .bg-vac       { background: #c8f0c8; }

  .bg-nolaboral { background: #fff3a0; }
  .bg-reintegro { background: #b8d8ff; }
  .bg-normal    { background: #fff;    }

  /* â”€â”€ Totals â”€â”€ */
  .totals-bar {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    padding: 10px 12px;
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 6px;
  }
  .total-card {
    display: flex;
    align-items: center;
    gap: 10px;
    background: #fff;
    border: 1px solid #dee2e6;
    border-radius: 5px;
    padding: 8px 14px 8px 10px;
    flex: 1;
    min-width: 155px;
  }
  .tc-swatch {
    width: 32px; height: 22px;
    border-radius: 4px;
    flex-shrink: 0;
    display: flex;
    overflow: hidden;
  }
  .tc-swatch span { flex: 1; display: block; }
  .tc-label { font-size: 11px; color: #666; flex: 1; white-space: nowrap; }
  .tc-value { font-size: 17px; font-weight: 700; color: #333; white-space: nowrap; }
  .tc-value em { font-size: 10px; font-weight: 400; font-style: normal; color: #999; margin-left: 2px; }

  /* â”€â”€ JSON panel â”€â”€ */
  .json-panel {
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 6px;
    padding: 10px 12px;
  }
  .json-panel summary {
    font-size: 12px; font-weight: 700; color: #555;
    cursor: pointer; user-select: none;
  }
  .json-panel summary:hover { color: #333; }
  .json-panel textarea {
    width: 100%; height: 120px; margin-top: 8px;
    font-size: 11px; font-family: 'Courier New', monospace;
    border: 1px solid #dee2e6; border-radius: 4px;
    padding: 6px 8px; resize: vertical; color: #333;
  }
  .json-panel .btn-load {
    margin-top: 6px; background: #0d6efd; color: #fff;
    border: none; border-radius: 4px; padding: 5px 14px;
    font-size: 12px; cursor: pointer;
  }
  .json-panel .btn-load:hover { background: #0b5ed7; }
  .json-error { margin-top: 5px; font-size: 11px; color: #dc3545; display: none; }
</style>
</head>
<body>
<div class="calendar-wrapper">

  <details class="json-panel">
    <summary>ðŸ“¥ Cargar datos JSON</summary>
    <textarea id="jsonInput" spellcheck="false"></textarea>
    <button class="btn-load" onclick="loadJSON()">Aplicar</button>
    <div class="json-error" id="jsonError"></div>
  </details>

  <div class="nav-bar">
    <button id="btnPrev" onclick="navigate(-1)">&#8249;</button>
    <span class="nav-label" id="navLabel"></span>
    <button id="btnNext" onclick="navigate(1)">&#8250;</button>
  </div>

  <div class="months-container" id="monthsContainer"></div>

  <div class="totals-bar" id="totalsBar"></div>

</div>
<script>
  const MONTHS_ES = ["Enero","Febrero","Marzo","Abril","Mayo","Junio",
                     "Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];
  const DAYS_ES   = ["Do","Lu","Ma","Mi","Ju","Vi","SÃ¡"];

  const TIPO_META = [
    { key:"vacaciones", label:"Vacaciones",         color:"#c8f0c8", colorDark:"#72c472", fullCls:"full-vac",       bgCls:"bg-vac"       },
    { key:"nolaboral",  label:"No Laborables",       color:"#fff3a0", colorDark:"#e6c800", fullCls:"full-nolaboral", bgCls:"bg-nolaboral" },
    { key:"reintegro",  label:"Vac. Reintegradas",   color:"#b8d8ff", colorDark:"#5aaaf5", fullCls:"full-reintegro", bgCls:"bg-reintegro" },
  ];

  let dayMap = {}, allMonths = [], startIdx = 0;
  const today    = new Date();
  const todayStr = fmt(today.getFullYear(), today.getMonth()+1, today.getDate());

  /* â”€â”€ Sample data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     Inicia 27-ene (fin de enero) y se extiende por febrero
     completo hasta el 3-mar. Tipos intercalados a lo largo
     de los 3 meses.

     Vacaciones   : 21.5 dÃ­as
     No Laborables: 12   dÃ­as
     Reintegro    : 2.5  dÃ­as   (incluye medio dÃ­a el 25-feb)
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  const sampleData = [
    // â”€â”€ Enero (fin de mes) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    { fecha:"2025-01-27", tipo:"vacaciones"  },
    { fecha:"2025-01-28", tipo:"nolaboral"   },
    { fecha:"2025-01-29", tipo:"vacaciones"  },
    { fecha:"2025-01-30", tipo:"nolaboral"   },
    { fecha:"2025-01-31", tipo:"vacaciones"  },

    // â”€â”€ Febrero (mes completo) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    { fecha:"2025-02-01", tipo:"nolaboral"   },
    { fecha:"2025-02-02", tipo:"vacaciones"  },
    { fecha:"2025-02-03", tipo:"nolaboral"   },
    { fecha:"2025-02-04", tipo:"vacaciones"  },
    { fecha:"2025-02-05", tipo:"nolaboral"   },
    { fecha:"2025-02-06", tipo:"vacaciones"  },
    { fecha:"2025-02-07", tipo:"nolaboral"   },
    { fecha:"2025-02-08", tipo:"vacaciones"  },
    { fecha:"2025-02-09", tipo:"nolaboral"   },
    { fecha:"2025-02-10", tipo:"vacaciones"  },
    { fecha:"2025-02-11", tipo:"nolaboral"   },
    { fecha:"2025-02-12", tipo:"vacaciones"  },
    { fecha:"2025-02-13", tipo:"nolaboral"   },
    { fecha:"2025-02-14", tipo:"vacaciones"  },
    { fecha:"2025-02-15", tipo:"reintegro"   },
    { fecha:"2025-02-16", tipo:"vacaciones"  },
    { fecha:"2025-02-17", tipo:"reintegro"   },
    { fecha:"2025-02-18", tipo:"vacaciones"  },
    { fecha:"2025-02-19", tipo:"nolaboral"   },
    { fecha:"2025-02-20", tipo:"vacaciones"  },
    { fecha:"2025-02-21", tipo:"nolaboral"   },
    { fecha:"2025-02-22", tipo:"vacaciones"  },
    { fecha:"2025-02-23", tipo:"vacaciones"  },
    { fecha:"2025-02-24", tipo:"vacaciones"  },
    { fecha:"2025-02-25", am:"vacaciones",   pm:"reintegro" },
    { fecha:"2025-02-26", tipo:"vacaciones"  },
    { fecha:"2025-02-27", tipo:"vacaciones"  },
    { fecha:"2025-02-28", tipo:"vacaciones"  },

    // â”€â”€ Marzo (inicio de mes) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    { fecha:"2025-03-01", tipo:"vacaciones"  },
    { fecha:"2025-03-02", tipo:"nolaboral"   },
    { fecha:"2025-03-03", tipo:"vacaciones"  },
  ];

  /* â”€â”€ Helpers â”€â”€ */
  function fmt(y,m,d){ return y+"-"+String(m).padStart(2,"0")+"-"+String(d).padStart(2,"0"); }
  function meta(tipo){ return TIPO_META.find(t=>t.key===tipo)||null; }

  /* â”€â”€ Apply data â”€â”€ */
  function applyData(data){
    dayMap = {};
    const mset = new Set();
    data.forEach(item=>{
      if(!item.fecha) return;
      const k = item.fecha.trim();
      const [y,m] = k.split("-");
      mset.add(y+"-"+m);
      if(item.am||item.pm) dayMap[k]={am:item.am||null,pm:item.pm||null};
      else if(item.tipo)   dayMap[k]={tipo:item.tipo};
    });
    allMonths = Array.from(mset).sort().map(s=>{
      const [y,m]=s.split("-");
      return {year:parseInt(y),month:parseInt(m)-1};
    });
    if(!allMonths.length) allMonths=[{year:today.getFullYear(),month:today.getMonth()}];
    startIdx=0;
    render();
  }

  /* â”€â”€ Navigate â”€â”€ */
  function navigate(d){ startIdx=Math.max(0,Math.min(startIdx+d,allMonths.length-1)); render(); }

  /* â”€â”€ Totals â”€â”€ */
  function renderTotals(){
    const T={};
    TIPO_META.forEach(t=>T[t.key]=0);
    Object.values(dayMap).forEach(e=>{
      if(e.am!==undefined){
        if(e.am&&T[e.am]!==undefined) T[e.am]+=0.5;
        if(e.pm&&T[e.pm]!==undefined) T[e.pm]+=0.5;
      } else if(e.tipo&&T[e.tipo]!==undefined) T[e.tipo]+=1;
    });

    const bar=document.getElementById("totalsBar");
    bar.innerHTML="";
    TIPO_META.forEach(m=>{
      const v=T[m.key];
      const disp=(v%1!==0)?v.toFixed(1):v;
      const card=document.createElement("div");
      card.className="total-card";
      card.innerHTML=`
        <div class="tc-swatch" style="border:1px solid ${m.colorDark};">
          <span style="background:${m.color};"></span>
          <span style="background:${m.color};filter:brightness(0.88);"></span>
        </div>
        <div class="tc-label">${m.label}</div>
        <div class="tc-value">${disp}<em>dÃ­as</em></div>`;
      bar.appendChild(card);
    });
  }

  /* â”€â”€ Render â”€â”€ */
  function render(){
    const vis = allMonths.slice(startIdx, startIdx+3);
    const f=vis[0], l=vis[vis.length-1];
    document.getElementById("navLabel").textContent =
      vis.length>1
        ? MONTHS_ES[f.month]+" "+f.year+" â€“ "+MONTHS_ES[l.month]+" "+l.year
        : MONTHS_ES[f.month]+" "+f.year;
    document.getElementById("btnPrev").disabled=(startIdx===0);
    document.getElementById("btnNext").disabled=(startIdx+3>=allMonths.length);

    const cont=document.getElementById("monthsContainer");
    cont.innerHTML="";
    vis.forEach((mv,i)=>{
      if(i>0){ const d=document.createElement("div"); d.className="month-divider"; cont.appendChild(d); }
      cont.appendChild(buildMonth(mv.year,mv.month));
    });
    renderTotals();
  }

  /* â”€â”€ Build single month â”€â”€ */
  function buildMonth(year,month){
    const block=document.createElement("div");
    block.className="month-block";

    const title=document.createElement("div");
    title.className="month-title";
    title.textContent=MONTHS_ES[month]+" "+year;
    block.appendChild(title);

    const grid=document.createElement("div");
    grid.className="cal-grid";

    DAYS_ES.forEach(d=>{ const el=document.createElement("div"); el.className="day-name"; el.textContent=d; grid.appendChild(el); });

    const firstDow  = new Date(year,month,1).getDay();
    const daysInMon = new Date(year,month+1,0).getDate();

    for(let i=0;i<firstDow;i++){ const el=document.createElement("div"); el.className="day-cell empty"; grid.appendChild(el); }

    for(let d=1;d<=daysInMon;d++){
      const ds    = fmt(year,month+1,d);
      const entry = dayMap[ds];
      const cell  = document.createElement("div");
      cell.className="day-cell";
      if(ds===todayStr) cell.classList.add("today");

      if(entry){
        if(entry.am!==undefined){
          cell.classList.add("half");
          const hl=document.createElement("div");
          const hr=document.createElement("div");
          hl.className="half-left  "+(meta(entry.am)?meta(entry.am).bgCls:"bg-normal");
          hr.className="half-right "+(meta(entry.pm)?meta(entry.pm).bgCls:"bg-normal");
          cell.appendChild(hl); cell.appendChild(hr);
        } else {
          const m=meta(entry.tipo);
          cell.classList.add(m?m.fullCls:"normal");
        }
      } else {
        cell.classList.add("normal");
      }

      const num=document.createElement("span");
      num.className="day-num"; num.textContent=d;
      cell.appendChild(num);
      grid.appendChild(cell);
    }

    block.appendChild(grid);
    return block;
  }

  /* â”€â”€ JSON panel â”€â”€ */
  function loadJSON(){
    const errEl=document.getElementById("jsonError");
    errEl.style.display="none";
    try{
      const data=JSON.parse(document.getElementById("jsonInput").value.trim());
      if(!Array.isArray(data)) throw new Error("Se esperaba un array JSON");
      applyData(data);
    }catch(e){ errEl.textContent="JSON invÃ¡lido: "+e.message; errEl.style.display="block"; }
  }

  /* â”€â”€ postMessage API â”€â”€ */
  window.addEventListener("message",function(e){
    if(e.data&&e.data.type==="loadData"&&Array.isArray(e.data.data)) applyData(e.data.data);
  });

  /* â”€â”€ Init â”€â”€ */
  document.getElementById("jsonInput").value=JSON.stringify(sampleData,null,2);
  applyData(sampleData);
</script>
</body>
</html>
